<html lang="en">
<head>
    <title>Operator - Mosquitto</title>
    <meta charset="utf-8"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript" crossorigin="anonymous"></script>
    <link href="style.css" rel="stylesheet">
    <script type="text/javascript">
        let mqtt;
        let reconnectTimeout = 2000;
        let host = "127.0.0.1";
        let port = 9001;

        function onFailure(message) {
            console.log("Connection attempt failed");
            setTimeout(MQTTconnect, reconnectTimeout);
        }

        function onMessageArrived(msg) {
            // console.log(msg.payloadString);
            document.getElementById("output").value += "\n" + msg.payloadString;
        }

        function onConnect() {
            console.log("Connected");
            mqtt.subscribe("$SYS/broker/log/#");
        }

        function MQTTconnect() {
            console.log("Connecting to " + host + ":" + port + "...");
            mqtt = new Paho.MQTT.Client(host, port, "", "clientjs");
            let options = {timeout: 3, onSuccess: onConnect, onFailure: onFailure};
            mqtt.onMessageArrived = onMessageArrived;
            mqtt.connect(options);
        }

    </script>
</head>
<body>
<nav>
    <div class="navitem"><a href="index.html">Control</a></div>
    <div class="navitem"><a href="cameras.html">Cameras</a></div>
    <div class="navitem selected"><a href="debug.html">Mosquitto</a></div>
</nav>
<textarea id="output" readonly></textarea>
<script>
    MQTTconnect();
</script>
</body>
</html>
